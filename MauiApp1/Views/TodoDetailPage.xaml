<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MauiApp1.ViewModels"
             x:Class="MauiApp1.Views.TodoDetailPage"
             Title="Chi Tiết Công Việc"
             BackgroundColor="White">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Sửa" 
                 Command="{Binding EnableEditCommand}"
                 IsEnabled="{Binding IsNotEditing}" />
    </ContentPage.ToolbarItems>

    <ScrollView>
        <VerticalStackLayout Spacing="15" Padding="20">

            <Label Text="{Binding Item.Title}" FontSize="22" FontAttributes="Bold" TextColor="{Binding Item.Color}"
                   IsVisible="{Binding IsNotEditing}"/>
            <Entry Text="{Binding Item.Title}" FontSize="22" FontAttributes="Bold" Placeholder="Tên công việc"
                   IsVisible="{Binding IsEditing}" BackgroundColor="#F0F0F0"/>

            <BoxView HeightRequest="1" Color="LightGray" />

            <Grid ColumnDefinitions="*,*">
                <VerticalStackLayout>
                    <Label Text="Hạn chót" FontSize="12" TextColor="Gray"/>

                    <Label Text="{Binding Item.Deadline, StringFormat='{0:dd/MM/yyyy}'}" FontSize="16"
                           IsVisible="{Binding IsNotEditing}"/>
                    <DatePicker Date="{Binding Item.Deadline}" Format="dd/MM/yyyy"
                                IsVisible="{Binding IsEditing}"/>
                </VerticalStackLayout>

                <VerticalStackLayout Grid.Column="1">
                    <Label Text="Mức độ ưu tiên" FontSize="12" TextColor="Gray"/>

                    <Label Text="{Binding Item.Priority}" FontSize="16" FontAttributes="Italic"
                           IsVisible="{Binding IsNotEditing}"/>
                    <Picker ItemsSource="{Binding Priorities}" SelectedItem="{Binding Item.Priority}"
                            IsVisible="{Binding IsEditing}" Title="Chọn mức độ"/>
                </VerticalStackLayout>
            </Grid>

            <BoxView HeightRequest="1" Color="LightGray" />

            <Label Text="Nội dung / Ghi chú:" FontSize="14" FontAttributes="Bold" TextColor="#333"/>

            <Frame BorderColor="LightGray" CornerRadius="5" Padding="10" BackgroundColor="#FAFAFA">
                <Grid>
                    <Label Text="{Binding Item.Content}" FontSize="16" TextColor="Black" LineBreakMode="WordWrap"
                           IsVisible="{Binding IsNotEditing}"/>
                    <Editor Text="{Binding Item.Content}" FontSize="16" AutoSize="TextChanges" Placeholder="Nhập ghi chú..."
                            IsVisible="{Binding IsEditing}" BackgroundColor="White"/>
                </Grid>
            </Frame>

            <HorizontalStackLayout Spacing="10" Margin="0,10,0,0">
                <Label Text="Trạng thái:" VerticalOptions="Center"/>
                <CheckBox IsChecked="{Binding Item.IsCompleted}" IsEnabled="{Binding IsEditing}" />
                <Label Text="{Binding Item.IsCompleted}" VerticalOptions="Center" TextColor="Gray"/>
            </HorizontalStackLayout>

            <Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="0,20,0,0">
                <Button Grid.ColumnSpan="2" Text="Quay lại" Command="{Binding GoBackCommand}" BackgroundColor="Gray"
                        IsVisible="{Binding IsNotEditing}"/>

                <Button Grid.Column="0" Text="Lưu thay đổi" Command="{Binding SaveCommand}" BackgroundColor="#1877F2"
                        IsVisible="{Binding IsEditing}"/>

                <Button Grid.Column="1" Text="Hủy" Command="{Binding GoBackCommand}" BackgroundColor="Orange"
                        IsVisible="{Binding IsEditing}"/>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>